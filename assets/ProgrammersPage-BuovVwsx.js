import{r as m,j as e,m as D,n as k,o as I,s as A}from"./index-Dn3ahLg1.js";import{a as G,u as M}from"./firestore-DR2U52vX.js";class n{static required(s){return!s||typeof s=="string"&&s.trim().length===0?"Este campo es requerido":null}static minLength(s,r){return s&&s.length<r?`MÃ­nimo ${r} caracteres`:null}static maxLength(s,r){return s&&s.length>r?`MÃ¡ximo ${r} caracteres`:null}static min(s,r){return s==null?null:s<r?`Valor mÃ­nimo: ${r}`:null}static max(s,r){return s==null?null:s>r?`Valor mÃ¡ximo: ${r}`:null}static email(s){return s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?null:"Email no vÃ¡lido":null}static url(s){if(!s)return null;try{return new URL(s),null}catch{return"URL no vÃ¡lida"}}static pattern(s,r,h){return s?r.test(s)?null:h:null}static validate(s,r){for(const h of r){const u=h(s);if(u)return u}return null}static validateForm(s,r){const h={};for(const u in r){const b=n.validate(s[u],r[u]);b&&(h[u]=b)}return h}static hasErrors(s){return Object.keys(s).length>0}static clearErrors(){return{}}}const E={uid:"",displayName:"",email:"",specialty:"",bio:"",role:"programmer",photoURL:"",github:"",instagram:"",whatsapp:""},O=()=>{const[t,s]=m.useState(E),[r,h]=m.useState([]),[u,b]=m.useState(!1),[v,w]=m.useState(""),[R,N]=m.useState(""),[L,P]=m.useState(null),[C,U]=m.useState(""),[l,g]=m.useState({}),[i,f]=m.useState({}),j={uid:[a=>n.required(a)],displayName:[a=>n.required(a),a=>n.minLength(a,3)],email:[a=>n.required(a),a=>n.email(a)],specialty:[a=>n.required(a),a=>n.minLength(a,3)],bio:[a=>n.minLength(a,10)],github:[a=>a&&n.url(a)],instagram:[a=>a&&n.url(a)],whatsapp:[a=>a&&n.url(a)]},$=async()=>{const a=await G();h(a)};m.useEffect(()=>{$()},[]);const p=a=>{const{name:o,value:c}=a.target;if(s(d=>({...d,[o]:c})),i[o]){const d=j[o];if(d){const y=n.validate(c,d);g(q=>({...q,[o]:y||""}))}}},x=a=>{f(c=>({...c,[a]:!0}));const o=j[a];if(o){const c=n.validate(t[a],o);g(d=>({...d,[a]:c||""}))}},S=a=>{const o=a.target.files?.[0];if(o){P(o);const c=new FileReader;c.onloadend=()=>{U(c.result)},c.readAsDataURL(o)}},B=async(a,o)=>{const c=D(A,`programmers/${a}/profile.jpg`);return await k(c,o),await I(c)},F=async a=>{a.preventDefault();const o=Object.keys(j).reduce((d,y)=>(d[y]=!0,d),{});f(o);const c=n.validateForm(t,j);if(g(c),n.hasErrors(c)){N("Por favor corrige los errores en el formulario.");return}b(!0),N(""),w("");try{let d=t.photoURL;L&&(d=await B(t.uid,L)),await M(t.uid,{displayName:t.displayName,email:t.email,specialty:t.specialty,bio:t.bio,role:"programmer",photoURL:d,socials:{github:t.github||void 0,instagram:t.instagram||void 0,whatsapp:t.whatsapp||void 0}}),w("âœ“ Programador guardado correctamente."),s(E),P(null),U(""),g({}),f({}),await $()}catch{N("No se pudo guardar. Verifica permisos y conexiÃ³n.")}finally{b(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Programadores"}),e.jsx("p",{className:"text-base-content/70",children:"Crea o edita perfiles y asigna el rol de programador."})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx("form",{onSubmit:F,className:"card bg-base-100 shadow-md",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsx("h2",{className:"card-title",children:"Nuevo / editar"}),v&&e.jsx("div",{className:"alert alert-success text-sm",children:v}),R&&e.jsx("div",{className:"alert alert-error text-sm",children:R}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Foto de perfil"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2",children:C||t.photoURL?e.jsx("img",{src:C||t.photoURL,alt:"Preview"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-base-300",children:e.jsx("span",{className:"text-3xl",children:"ðŸ‘¤"})})})}),e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"file-input file-input-bordered file-input-sm w-full max-w-xs"})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"UID de Firebase *"})}),e.jsx("input",{name:"uid",value:t.uid,onChange:p,onBlur:()=>x("uid"),className:`input input-bordered ${i.uid&&l.uid?"input-error":""}`,placeholder:"UID del usuario autenticado"}),i.uid&&l.uid&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.uid})}),e.jsx("span",{className:"label-text-alt text-base-content/60",children:"Se crea el documento en users con este UID y rol programmer."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Nombre *"})}),e.jsx("input",{name:"displayName",value:t.displayName,onChange:p,onBlur:()=>x("displayName"),className:`input input-bordered ${i.displayName&&l.displayName?"input-error":""}`}),i.displayName&&l.displayName&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.displayName})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Correo *"})}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:p,onBlur:()=>x("email"),className:`input input-bordered ${i.email&&l.email?"input-error":""}`}),i.email&&l.email&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.email})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Especialidad *"})}),e.jsx("input",{name:"specialty",value:t.specialty,onChange:p,onBlur:()=>x("specialty"),className:`input input-bordered ${i.specialty&&l.specialty?"input-error":""}`}),i.specialty&&l.specialty&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.specialty})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Bio"})}),e.jsx("textarea",{name:"bio",value:t.bio,onChange:p,onBlur:()=>x("bio"),className:`textarea textarea-bordered ${i.bio&&l.bio?"textarea-error":""}`,rows:3}),i.bio&&l.bio&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.bio})})]}),e.jsx("div",{className:"divider",children:"Redes Sociales"}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"GitHub"})}),e.jsx("input",{name:"github",value:t.github,onChange:p,onBlur:()=>x("github"),className:`input input-bordered ${i.github&&l.github?"input-error":""}`,placeholder:"https://github.com/usuario"}),i.github&&l.github&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.github})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Instagram"})}),e.jsx("input",{name:"instagram",value:t.instagram,onChange:p,onBlur:()=>x("instagram"),className:`input input-bordered ${i.instagram&&l.instagram?"input-error":""}`,placeholder:"https://instagram.com/usuario"}),i.instagram&&l.instagram&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.instagram})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"WhatsApp"})}),e.jsx("input",{name:"whatsapp",value:t.whatsapp,onChange:p,onBlur:()=>x("whatsapp"),className:`input input-bordered ${i.whatsapp&&l.whatsapp?"input-error":""}`,placeholder:"https://wa.me/593988888888"}),i.whatsapp&&l.whatsapp&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.whatsapp})})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:u,children:u?"Guardando...":"Guardar programador"})})]})}),e.jsx("div",{className:"card bg-base-100 shadow-md",children:e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"card-title",children:"Listado"}),e.jsx("span",{className:"badge badge-secondary",children:r.length})]}),e.jsxs("div",{className:"space-y-2",children:[r.map(a=>e.jsx("div",{className:"flex flex-col rounded-lg border border-base-200 p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-12 rounded-full",children:a.photoURL?e.jsx("img",{src:a.photoURL,alt:a.displayName}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-base-300",children:e.jsx("span",{className:"text-lg",children:"ðŸ‘¤"})})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold",children:a.displayName}),e.jsx("span",{className:"badge badge-outline capitalize",children:a.specialty||"Especialidad"})]}),e.jsx("p",{className:"text-xs text-base-content/60",children:a.email}),e.jsx("p",{className:"text-sm text-base-content/70",children:a.bio}),a.socials&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[a.socials.github&&e.jsx("a",{href:a.socials.github,target:"_blank",rel:"noopener noreferrer",className:"badge badge-ghost badge-sm",children:"GitHub"}),a.socials.instagram&&e.jsx("a",{href:a.socials.instagram,target:"_blank",rel:"noopener noreferrer",className:"badge badge-ghost badge-sm",children:"Instagram"}),a.socials.whatsapp&&e.jsx("a",{href:a.socials.whatsapp,target:"_blank",rel:"noopener noreferrer",className:"badge badge-ghost badge-sm",children:"WhatsApp"})]})]})]})},a.id)),!r.length&&e.jsx("div",{className:"alert alert-info text-sm",children:"AÃºn no hay programadores. Crea uno con el formulario."})]})]})})]})]})};export{O as default};
