import{u as k,r as o,j as e,i as C,e as E,m as A,h as L,s as U}from"./index-C7oHUGbv.js";import{A as z,y as G}from"./index-QdZ3WDKL.js";const I={displayName:"",email:"",specialty:"",bio:"",github:"",instagram:"",whatsapp:""},q=()=>{const{user:r}=k(),[a,b]=o.useState(I),[x,g]=o.useState(!1),[N,f]=o.useState(""),[j,u]=o.useState(""),[v,y]=o.useState(null),[F,w]=o.useState(""),[n,p]=o.useState(["JavaScript","React"]),[c,h]=o.useState("");o.useEffect(()=>{(async()=>{if(r?.uid)try{const s=C(E,"users",r.uid),l=await A(s);if(l.exists()){const t=l.data();b({displayName:t.displayName||"",email:t.email||"",specialty:t.specialty||"",bio:t.bio||"",github:t.socials?.github||"",instagram:t.socials?.instagram||"",whatsapp:t.socials?.whatsapp||""}),p(t.skills||["JavaScript","React"]);const m=localStorage.getItem(`photo_${r.uid}`);w(m||t.photoURL||"")}}catch(s){console.error("Error cargando perfil:",s)}})()},[r?.uid]);const d=i=>{const{name:s,value:l}=i.target;b(t=>({...t,[s]:l}))},P=i=>{const s=i.target.files?.[0];if(s){y(s);const l=new FileReader;l.onloadend=()=>{w(l.result)},l.readAsDataURL(s)}},R=async i=>{if(i.preventDefault(),!r?.uid){u("Usuario no autenticado");return}g(!0),f(""),u("");try{console.log("ðŸ”„ Iniciando actualizaciÃ³n de perfil...");let s=r.photoURL;if(v){console.log("ðŸ“¸ Guardando foto en localStorage...");const m=new FileReader;s=await new Promise(D=>{m.onloadend=()=>{const S=m.result;localStorage.setItem(`photo_${r.uid}`,S),console.log("âœ… Foto guardada en localStorage"),D(S)},m.readAsDataURL(v)})}const l={};a.github&&(l.github=a.github),a.instagram&&(l.instagram=a.instagram),a.whatsapp&&(l.whatsapp=a.whatsapp),console.log("ðŸ“ Datos a guardar:",{displayName:a.displayName,specialty:a.specialty,bio:a.bio,socials:l});const t=C(E,"users",r.uid);console.log("ðŸ”¥ Actualizando Firestore documento:",r.uid),await L(t,{displayName:a.displayName,email:a.email,specialty:a.specialty,bio:a.bio,skills:n,socials:l,updatedAt:U()}),console.log("âœ… Perfil actualizado en Firestore"),f("âœ“ Perfil actualizado correctamente."),y(null)}catch(s){console.error("âŒ Error completo:",s),console.error("CÃ³digo:",s.code),console.error("Mensaje:",s.message),u(`Error: ${s.message||"No se pudo actualizar"}`)}finally{g(!1)}};return e.jsxs("div",{className:"max-w-3xl space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Editar mi perfil"}),e.jsx("form",{onSubmit:R,className:"card bg-base-100 shadow-md",children:e.jsxs("div",{className:"card-body space-y-4",children:[N&&e.jsx("div",{className:"alert alert-success text-sm",children:N}),j&&e.jsx("div",{className:"alert alert-error text-sm",children:j}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-semibold",children:"Foto de perfil"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2",children:e.jsx("img",{src:F||"/default-avatar.png",alt:"Preview"})})}),e.jsxs("label",{className:"btn btn-outline gap-2",children:[e.jsx(z,{}),"Cambiar foto",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:P})]})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Nombre completo *"})}),e.jsx("input",{name:"displayName",value:a.displayName,onChange:d,className:"input input-bordered",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Email *"})}),e.jsx("input",{name:"email",type:"email",value:a.email,onChange:d,className:"input input-bordered",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Especialidad"})}),e.jsx("input",{name:"specialty",value:a.specialty,onChange:d,className:"input input-bordered",placeholder:"Ej: Frontend Developer"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"BiografÃ­a"})}),e.jsx("textarea",{name:"bio",value:a.bio,onChange:d,className:"textarea textarea-bordered",rows:4,placeholder:"CuÃ©ntanos sobre ti..."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-semibold",children:"Habilidades (mÃ­nimo 2)"})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:n.map((i,s)=>e.jsxs("div",{className:"badge badge-primary gap-2",children:[i,e.jsx("button",{type:"button",onClick:()=>p(n.filter((l,t)=>t!==s)),className:"btn btn-ghost btn-xs",children:"âœ•"})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:i=>h(i.target.value),className:"input input-bordered flex-1",placeholder:"Ej: TypeScript",onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),c.trim()&&!n.includes(c.trim())&&(p([...n,c.trim()]),h("")))}}),e.jsx("button",{type:"button",onClick:()=>{c.trim()&&!n.includes(c.trim())&&(p([...n,c.trim()]),h(""))},className:"btn btn-secondary",children:"Agregar"})]})]}),e.jsx("div",{className:"divider",children:"Redes Sociales"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"GitHub"})}),e.jsx("input",{name:"github",value:a.github,onChange:d,className:"input input-bordered input-sm",placeholder:"https://github.com/..."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Instagram"})}),e.jsx("input",{name:"instagram",value:a.instagram,onChange:d,className:"input input-bordered input-sm",placeholder:"https://instagram.com/..."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"WhatsApp"})}),e.jsx("input",{name:"whatsapp",value:a.whatsapp,onChange:d,className:"input input-bordered input-sm",placeholder:"https://wa.me/..."})]})]}),e.jsx("div",{className:"card-actions justify-end pt-2",children:e.jsxs("button",{className:"btn btn-primary gap-2",type:"submit",disabled:x,children:[e.jsx(G,{}),x?"Guardando...":"Guardar cambios"]})})]})})]})};export{q as default};
