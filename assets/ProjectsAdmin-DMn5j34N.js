import{u as ae,r as i,g as se,d as O,e as j,j as e,N as te,T as le,h as re,i as $,k as ie,l as ne}from"./index-BVC0icWY.js";import{v as oe,w as U,q as ce,x as K,y as D,z as de,A as me}from"./index-GXs0CitT.js";import{F as o}from"./FormUtils-X4tq9MxD.js";import{m as F}from"./proxy-8BQsh3A1.js";const je=()=>{const{user:H}=ae(),[C,V]=i.useState([]),[N,y]=i.useState(!1),[u,E]=i.useState(null),[A,S]=i.useState(!1),[T,P]=i.useState(null),[q,R]=i.useState(""),[c,h]=i.useState(["React","Firebase"]),[d,g]=i.useState(["Alexis"]),[b,f]=i.useState(""),[p,v]=i.useState(""),[t,n]=i.useState({title:"",description:"",imageUrl:"",githubUrl:"",demoUrl:"",category:"academico"}),[ue,k]=i.useState({}),[he,I]=i.useState({}),M={title:[a=>o.required(a),a=>o.minLength(a,3)],description:[a=>o.required(a),a=>o.minLength(a,10)],githubUrl:[a=>a&&o.url(a)],demoUrl:[a=>a&&o.url(a)]};i.useEffect(()=>{w()},[]);const w=async()=>{try{const l=(await se(O(j,"projects"))).docs.map(s=>({id:s.id,...s.data(),createdAt:s.data().createdAt?.toDate()||new Date}));V(l.sort((s,r)=>r.createdAt.getTime()-s.createdAt.getTime()))}catch(a){console.error("Error fetching projects:",a)}},L=()=>{!b.trim()||b.length<2||(h([...c,b.trim()]),f(""))},X=a=>{h(c.filter((l,s)=>s!==a))},_=()=>{!p.trim()||p.length<3||(g([...d,p.trim()]),v(""))},B=a=>{g(d.filter((l,s)=>s!==a))},J=a=>{const l=a.target.files?.[0];if(l){P(l);const s=new FileReader;s.onloadend=()=>{R(s.result)},s.readAsDataURL(l)}},Q=async a=>{a.preventDefault();const l=Object.keys(M).reduce((r,m)=>(r[m]=!0,r),{});I(l);const s=o.validateForm(t,M);if(k(s),c.length<1&&(s.technologies="Debe tener al menos 1 tecnología"),d.length<1&&(s.teamMembers="Debe tener al menos 1 miembro del equipo"),o.hasErrors(s)){alert("Por favor corrige los errores en el formulario.");return}S(!0);try{let r=t.imageUrl;if(T){const x=new FileReader;r=await new Promise(Z=>{x.onloadend=()=>{const G=x.result,ee=u||`proj_${Date.now()}`;localStorage.setItem(`project_img_${ee}`,G),Z(G)},x.readAsDataURL(T)})}const m={title:t.title,description:t.description,imageUrl:r,githubUrl:t.githubUrl,technologies:c,teamMembers:d,category:t.category,createdAt:le.now()};if(t.demoUrl&&t.demoUrl.trim()!==""&&(m.demoUrl=t.demoUrl),u)console.log("Actualizando proyecto:",u,m),await re($(j,"projects",u),m),console.log("✓ Proyecto actualizado exitosamente");else{console.log("Creando nuevo proyecto:",m);const x=await ie(O(j,"projects"),m);console.log("✓ Proyecto creado con ID:",x.id)}alert("✓ Proyecto guardado correctamente."),z(),await w()}catch(r){console.error("❌ Error completo al guardar proyecto:",r),alert(`Error al guardar: ${r.message||"Verifica permisos de Firebase"}`)}finally{S(!1)}},W=a=>{n({title:a.title,description:a.description,imageUrl:a.imageUrl,githubUrl:a.githubUrl,demoUrl:a.demoUrl||"",category:a.category||"academico"}),h(a.technologies||[]),g(a.teamMembers||[]),E(a.id),y(!0)},Y=async a=>{if(confirm("¿Estás seguro de eliminar este proyecto?"))try{await ne($(j,"projects",a)),w()}catch(l){console.error("Error deleting project:",l),alert("Error al eliminar el proyecto")}},z=()=>{n({title:"",description:"",imageUrl:"",githubUrl:"",demoUrl:"",category:"academico"}),h(["React","Firebase"]),g(["Alexis"]),f(""),v(""),P(null),R(""),E(null),y(!1),k({}),I({})};return H?e.jsx("div",{className:"min-h-screen bg-base-200",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(F.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Administrar Proyectos"}),e.jsx("p",{className:"text-base-content/70",children:"Gestiona los proyectos del equipo"})]}),e.jsx("button",{onClick:()=>y(!N),className:"btn btn-primary gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-5"}),"Cancelar"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5"}),"Nuevo Proyecto"]})})]}),N&&e.jsx(F.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card bg-base-100 shadow-xl mb-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:u?"Editar Proyecto":"Nuevo Proyecto"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Título *"})}),e.jsx("input",{type:"text",value:t.title,onChange:a=>n({...t,title:a.target.value}),className:"input input-bordered",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"URL de GitHub *"})}),e.jsxs("div",{className:"join w-full",children:[e.jsx("span",{className:"join-item btn btn-disabled",children:e.jsx(ce,{className:"h-5 w-5"})}),e.jsx("input",{type:"url",value:t.githubUrl,onChange:a=>n({...t,githubUrl:a.target.value}),className:"input input-bordered join-item w-full",placeholder:"https://github.com/...",required:!0})]})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Descripción *"})}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),className:"textarea textarea-bordered h-24",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Categoría del Proyecto *"})}),e.jsxs("select",{value:t.category,onChange:a=>n({...t,category:a.target.value}),className:"select select-bordered",required:!0,children:[e.jsx("option",{value:"academico",children:"Académico"}),e.jsx("option",{value:"laboral",children:"Laboral"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Imagen del Proyecto *"})}),e.jsxs("div",{className:"space-y-2",children:[(q||t.imageUrl)&&e.jsx("div",{className:"relative w-full h-48 rounded-lg overflow-hidden border-2 border-base-300",children:e.jsx("img",{src:q||t.imageUrl,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:J,className:"file-input file-input-bordered w-full"}),e.jsx("div",{className:"divider text-xs",children:"O"}),e.jsxs("div",{className:"join w-full",children:[e.jsx("span",{className:"join-item btn btn-disabled",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx("input",{type:"url",value:t.imageUrl,onChange:a=>n({...t,imageUrl:a.target.value}),className:"input input-bordered join-item w-full",placeholder:"O pega una URL de imagen"})]})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"URL Demo (opcional)"})}),e.jsx("input",{type:"url",value:t.demoUrl,onChange:a=>n({...t,demoUrl:a.target.value}),className:"input input-bordered",placeholder:"https://..."})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-bold",children:"Tecnologías *"})}),e.jsxs("div",{className:"join mb-3",children:[e.jsx("input",{type:"text",value:b,onChange:a=>f(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),L())},className:"input input-bordered join-item flex-1",placeholder:"Agregar tecnología (ej: React, Node.js)"}),e.jsxs("button",{type:"button",onClick:L,className:"btn btn-primary join-item",children:[e.jsx(U,{})," Agregar"]})]}),e.jsxs("div",{className:"space-y-2",children:[(c||[]).map((a,l)=>e.jsxs("div",{className:"join w-full",children:[e.jsx("input",{type:"text",value:a,onChange:s=>{const r=[...c];r[l]=s.target.value,h(r)},className:"input input-bordered join-item flex-1"}),e.jsxs("button",{type:"button",onClick:()=>X(l),className:"btn btn-error join-item",children:[e.jsx(D,{})," Eliminar"]})]},l)),c.length===0&&e.jsx("div",{className:"alert alert-warning",children:"Debe agregar al menos 1 tecnología"})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-bold",children:"Miembros del Equipo *"})}),e.jsxs("div",{className:"join mb-3",children:[e.jsx("input",{type:"text",value:p,onChange:a=>v(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),_())},className:"input input-bordered join-item flex-1",placeholder:"Agregar miembro del equipo"}),e.jsxs("button",{type:"button",onClick:_,className:"btn btn-primary join-item",children:[e.jsx(U,{})," Agregar"]})]}),e.jsxs("div",{className:"space-y-2",children:[(d||[]).map((a,l)=>e.jsxs("div",{className:"join w-full",children:[e.jsx("input",{type:"text",value:a,onChange:s=>{const r=[...d];r[l]=s.target.value,g(r)},className:"input input-bordered join-item flex-1"}),e.jsxs("button",{type:"button",onClick:()=>B(l),className:"btn btn-error join-item",children:[e.jsx(D,{})," Eliminar"]})]},l)),d.length===0&&e.jsx("div",{className:"alert alert-warning",children:"Debe agregar al menos 1 miembro del equipo"})]})]}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{type:"button",onClick:z,className:"btn btn-ghost",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary gap-2",disabled:A,children:A?e.jsx("span",{className:"loading loading-spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-5 w-5"}),u?"Actualizar":"Guardar"]})})]})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:C.map((a,l)=>e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},className:"card bg-base-100 shadow-xl",children:[e.jsx("figure",{className:"h-48 bg-base-200",children:a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:a.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(K,{className:"h-16 w-16 text-base-content/30"})})}),e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:a.title}),e.jsx("p",{className:"text-sm text-base-content/70 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(a.technologies||[]).slice(0,3).map((s,r)=>e.jsx("span",{className:"badge badge-sm badge-primary badge-outline",children:s},r))}),e.jsxs("div",{className:"card-actions justify-end mt-4",children:[e.jsxs("button",{onClick:()=>W(a),className:"btn btn-sm btn-ghost gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>Y(a.id),className:"btn btn-sm btn-error gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Eliminar"]})]})]})]},a.id))}),C.length===0&&e.jsx("div",{className:"text-center py-20",children:e.jsx("p",{className:"text-base-content/70",children:"No hay proyectos todavía"})})]})}):e.jsx(te,{to:"/login",replace:!0})};export{je as default};
