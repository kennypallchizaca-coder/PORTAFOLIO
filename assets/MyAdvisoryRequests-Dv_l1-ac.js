import{r as t,j as e,L as M,q as D,d as B,e as k,w as L,g as T}from"./index-BVC0icWY.js";import{a as z,b as H}from"./firestore-DeDfMWJn.js";const q={programmerId:"",requesterName:"",requesterEmail:"",date:"",time:"",note:""},G=()=>{const[i,E]=t.useState(""),[b,C]=t.useState(!1),[o,A]=t.useState([]),[x,N]=t.useState(!1),[j,n]=t.useState(""),[g,d]=t.useState(!1),[a,h]=t.useState(q),[p,I]=t.useState([]),[v,f]=t.useState(!1),[y,S]=t.useState("");t.useEffect(()=>{z().then(I)},[]);const w=async s=>{if(s.preventDefault(),!i.trim()){n("Ingresa tu correo electrónico.");return}N(!0),n(""),C(!0);try{const r=D(B(k,"advisories"),L("requesterEmail","==",i.trim())),m=(await T(r)).docs.map(u=>({id:u.id,...u.data()}));A(m),h(u=>({...u,requesterEmail:i.trim()}))}catch(r){console.error("Error al buscar solicitudes:",r),n("No se pudieron cargar las solicitudes. Intenta nuevamente.")}finally{N(!1)}},c=s=>{const{name:r,value:l}=s.target;h(m=>({...m,[r]:l}))},R=async s=>{if(s.preventDefault(),!a.programmerId||!a.requesterName||!a.requesterEmail||!a.date||!a.time){n("Completa todos los campos obligatorios.");return}f(!0),n(""),S("");try{const r=p.find(l=>l.id===a.programmerId);await H({programmerId:a.programmerId,programmerEmail:r?.email,programmerName:r?.displayName,requesterName:a.requesterName,requesterEmail:a.requesterEmail,slot:{date:a.date,time:a.time},note:a.note}),S("Solicitud enviada exitosamente. Te avisaremos por correo cuando el programador responda."),h({...q,requesterEmail:i}),d(!1),await w(s)}catch(r){console.error("Error al enviar solicitud:",r),n("No se pudo enviar la solicitud. Intenta nuevamente.")}finally{f(!1)}},P=s=>{switch(s){case"pendiente":return e.jsx("span",{className:"badge badge-warning",children:"Pendiente"});case"aprobada":return e.jsx("span",{className:"badge badge-success",children:"Aprobada"});case"rechazada":return e.jsx("span",{className:"badge badge-error",children:"Rechazada"});default:return e.jsx("span",{className:"badge",children:s})}},F=s=>p.find(l=>l.id===s)?.displayName||"Programador";return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Mis Solicitudes de Asesoría"}),e.jsx("p",{className:"text-base-content/70",children:"Consulta el estado de tus solicitudes ingresando tu correo electrónico."})]}),e.jsx("div",{className:"card bg-base-100 shadow-lg",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:w,className:"flex gap-4",children:[e.jsx("div",{className:"form-control flex-1",children:e.jsx("input",{type:"email",value:i,onChange:s=>E(s.target.value),placeholder:"tu-correo@ejemplo.com",className:"input input-bordered",required:!0})}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Buscando...":"Buscar Solicitudes"})]})})}),j&&e.jsx("div",{className:"alert alert-error",children:j}),y&&e.jsx("div",{className:"alert alert-success",children:y}),b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:o.length===0?"No se encontraron solicitudes":`${o.length} solicitud(es) encontrada(s)`}),o.length>0&&!g&&e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>d(!0),children:"+ Nueva Solicitud"})]}),g&&e.jsx("div",{className:"card bg-base-100 shadow-lg border-2 border-primary",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Nueva Solicitud"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>d(!1),children:"✕"})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Programador *"})}),e.jsxs("select",{name:"programmerId",value:a.programmerId,onChange:c,className:"select select-bordered",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un programador"}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.displayName," · ",s.specialty]},s.id))]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tu nombre *"})}),e.jsx("input",{name:"requesterName",value:a.requesterName,onChange:c,className:"input input-bordered",placeholder:"Tu nombre",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Correo *"})}),e.jsx("input",{type:"email",name:"requesterEmail",value:a.requesterEmail,onChange:c,className:"input input-bordered",placeholder:"correo@ejemplo.com",required:!0})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Fecha *"})}),e.jsx("input",{type:"date",name:"date",value:a.date,onChange:c,className:"input input-bordered",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Hora *"})}),e.jsx("input",{type:"time",name:"time",value:a.time,onChange:c,className:"input input-bordered",required:!0})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Motivo / nota"})}),e.jsx("textarea",{name:"note",value:a.note,onChange:c,className:"textarea textarea-bordered",rows:3,placeholder:"Describe brevemente el motivo de tu solicitud..."})]}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:()=>d(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Enviando...":"Enviar Solicitud"})]})]})]})}),o.length>0?e.jsx("div",{className:"space-y-3",children:o.sort((s,r)=>{const l=s.createdAt?.toMillis?.()||0;return(r.createdAt?.toMillis?.()||0)-l}).map(s=>e.jsx("div",{className:"card bg-base-100 shadow-md hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Asesoría con ",F(s.programmerId)]}),e.jsx("p",{className:"text-sm text-base-content/60",children:s.requesterName})]}),P(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-base-content/60",children:"Fecha:"}),e.jsx("p",{className:"font-medium",children:s.slot?.date})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-base-content/60",children:"Hora:"}),e.jsx("p",{className:"font-medium",children:s.slot?.time})]})]}),s.note&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-base-content/60",children:"Tu nota:"}),e.jsx("p",{className:"text-sm",children:s.note})]}),s.responseMessage&&e.jsx("div",{className:`alert ${s.status==="aprobada"?"alert-success":"alert-error"} mt-3`,children:e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Respuesta del programador:"}),e.jsx("p",{children:s.responseMessage})]})}),e.jsxs("div",{className:"text-xs text-base-content/50 mt-2",children:["Solicitada: ",s.createdAt?.toDate?.().toLocaleDateString("es-ES")||"Fecha no disponible"]})]})},s.id))}):b&&!x&&e.jsx("div",{className:"card bg-base-100 shadow-md",children:e.jsxs("div",{className:"card-body text-center py-12",children:[e.jsx("p",{className:"text-base-content/60",children:"No tienes solicitudes registradas con este correo."}),e.jsx("p",{className:"text-sm text-base-content/50 mt-2",children:"¿Quieres solicitar una asesoría?"}),e.jsx("div",{className:"card-actions justify-center mt-4",children:e.jsx(M,{to:"/agendar-asesoria",className:"btn btn-primary",children:"Agendar Asesoría"})})]})})]})]})};export{G as default};
