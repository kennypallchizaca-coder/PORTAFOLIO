import{q as v,w as y,d as p,e as n,g as P,h as j,i as l,m as E,k as N,n as k,s as m,l as B}from"./index-DuBGklgq.js";class g{constructor(r=0,t="Network Error"){this.status=r,this.text=t}}const K=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,r)=>Promise.resolve(localStorage.setItem(e,r)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},o={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:K()},q=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},x=(e,r="https://api.emailjs.com")=>{if(!e)return;const t=q(e);o.publicKey=t.publicKey,o.blockHeadless=t.blockHeadless,o.storageProvider=t.storageProvider,o.blockList=t.blockList,o.limitRate=t.limitRate,o.origin=t.origin||r},R=async(e,r,t={})=>{const s=await fetch(o.origin+e,{method:"POST",headers:t,body:r}),a=await s.text(),i=new g(s.status,a);if(s.ok)return i;throw i},T=(e,r,t)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!r||typeof r!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},O=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},L=e=>e.webdriver||!e.languages||e.languages.length===0,_=()=>new g(451,"Unavailable For Headless Browser"),C=(e,r)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof r!="string")throw"The BlockList watchVariable has to be a string"},M=e=>!e.list?.length||!e.watchVariable,I=(e,r)=>e instanceof FormData?e.get(r):e[r],S=(e,r)=>{if(M(e))return!1;C(e.list,e.watchVariable);const t=I(r,e.watchVariable);return typeof t!="string"?!1:e.list.includes(t)},H=()=>new g(403,"Forbidden"),J=(e,r)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(r&&typeof r!="string")throw"The LimitRate ID has to be a non-empty string"},z=async(e,r,t)=>{const s=Number(await t.get(e)||0);return r-Date.now()+s},A=async(e,r,t)=>{if(!r.throttle||!t)return!1;J(r.throttle,r.id);const s=r.id||e;return await z(s,r.throttle,t)>0?!0:(await t.set(s,Date.now().toString()),!1)},D=()=>new g(429,"Too Many Requests"),G=async(e,r,t,s)=>{const a=q(s),i=a.publicKey||o.publicKey,u=a.blockHeadless||o.blockHeadless,f=a.storageProvider||o.storageProvider,h={...o.blockList,...a.blockList},w={...o.limitRate,...a.limitRate};return u&&L(navigator)?Promise.reject(_()):(T(i,e,r),O(t),t&&S(h,t)?Promise.reject(H()):await A(location.pathname,w,f)?Promise.reject(D()):R("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:e,template_id:r,template_params:t}),{"Content-type":"application/json"}))},U=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},W=e=>typeof e=="string"?document.querySelector(e):e,Q=async(e,r,t,s)=>{const a=q(s),i=a.publicKey||o.publicKey,u=a.blockHeadless||o.blockHeadless,f=o.storageProvider||a.storageProvider,h={...o.blockList,...a.blockList},w={...o.limitRate,...a.limitRate};if(u&&L(navigator))return Promise.reject(_());const b=W(t);T(i,e,r),U(b);const d=new FormData(b);return S(h,d)?Promise.reject(H()):await A(location.pathname,w,f)?Promise.reject(D()):(d.append("lib_version","4.4.1"),d.append("service_id",e),d.append("template_id",r),d.append("user_id",i),R("/api/v1.0/email/send-form",d))},X={init:x,send:G,sendForm:Q,EmailJSResponseStatus:g},Y="service_ut10vml",Z="template_vn2lufl",$="template_lo7pcvp",ee="ESq6kz1urCyDp34G8",re=e=>!!e,F=async(e,r)=>{if(!re(e)){console.warn("EmailJS no esta configurado; se omite el envio.");return}try{await X.send(Y,e,r,{publicKey:ee})}catch(t){console.error("Error al enviar correo:",t)}},te=async e=>{if(!e.programmerEmail){console.warn("No se envio correo: falta correo del programador.");return}await F($,{to_email:e.programmerEmail,programmer_name:e.programmerName||"Programador",requester_name:e.requesterName,requester_email:e.requesterEmail,date:e.date,time:e.time,note:e.note||"Sin comentarios adicionales."})},se=async e=>{if(!e.requesterEmail){console.warn("No se envio correo: falta correo del solicitante.");return}await F(Z,{to_email:e.requesterEmail,requester_name:e.requesterName||"Cliente",programmer_name:e.programmerName||"Programador",status:e.status,date:e.date||"Fecha por confirmar",time:e.time||"Hora por confirmar",response_message:e.responseMessage||(e.status==="aprobada"?"Tu solicitud fue aprobada.":"Tu solicitud fue rechazada.")})},c={users:"users",portfolios:"portfolios",projects:"projects",schedules:"schedules",advisories:"advisories"},V=async(e,r)=>{if(!e)return r||{};try{const t=l(n,c.users,e),s=await E(t);if(!s.exists())return r||{};const a=s.data();return{programmerEmail:a.email||r?.programmerEmail,programmerName:a.displayName||r?.programmerName}}catch(t){return console.error("No se pudo obtener el contacto del programador:",t),r||{}}},oe=async(e,r)=>{try{await k(l(n,c.users,e),{...r,updatedAt:m()})}catch(t){throw console.error("Error en upsertProgrammer:",t),t}},ie=async()=>{const e=v(p(n,c.users),y("role","==","programmer"));return(await P(e)).docs.map(t=>({id:t.id,available:t.data().available??!1,...t.data()}))},ne=async e=>{await B(l(n,c.users,e))},ce=async e=>{const r=l(n,c.portfolios,e),t=await E(r);return t.exists()?t.data():null},me=async(e,r)=>{await k(l(n,c.portfolios,e),{...r,ownerId:e,updatedAt:m()})},le=async e=>{const r=v(p(n,c.projects),y("ownerId","==",e));return(await P(r)).docs.map(s=>({id:s.id,...s.data()}))},de=async(e,r)=>await N(p(n,c.projects),{...r,ownerId:e,createdAt:m(),updatedAt:m()}),ue=async(e,r)=>j(l(n,c.projects,e),{...r,updatedAt:m()}),pe=async e=>{const r=await V(e.programmerId,{programmerEmail:e.programmerEmail,programmerName:e.programmerName}),t={...e,programmerEmail:r.programmerEmail,programmerName:r.programmerName,status:"pending",response:"",createdAt:m(),updatedAt:m()},s=await N(p(n,c.advisories),t);return await te({programmerEmail:t.programmerEmail,programmerName:t.programmerName,requesterName:e.requesterName,requesterEmail:e.requesterEmail,date:e.slot.date,time:e.slot.time,note:e.note}),s},ge=async e=>{const r=v(p(n,c.advisories),y("programmerId","==",e));return(await P(r)).docs.map(s=>({id:s.id,...s.data()}))},fe=async(e,r,t)=>{const s=l(n,c.advisories,e),a=await E(s);if(!a.exists())throw new Error("La asesoria no existe");const i=a.data();await j(s,{status:r,responseMessage:t,updatedAt:m()});const u=await V(i.programmerId,{programmerEmail:i.programmerEmail,programmerName:i.programmerName});await se({requesterEmail:i.requesterEmail,requesterName:i.requesterName,programmerName:u.programmerName,status:r,date:i.slot?.date,time:i.slot?.time,responseMessage:t})};export{ie as a,pe as b,me as c,ne as d,ue as e,de as f,ce as g,ge as h,fe as i,se as j,le as l,te as s,oe as u};
