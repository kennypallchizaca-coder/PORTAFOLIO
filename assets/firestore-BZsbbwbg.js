import{q as v,w as P,d as p,e as n,g as E,h as N,i as l,m as f,k,n as q,s as m,l as V}from"./index-C7oHUGbv.js";class g{constructor(r=0,t="Network Error"){this.status=r,this.text=t}}const x=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,r)=>Promise.resolve(localStorage.setItem(e,r)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},o={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:x()},j=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},K=(e,r="https://api.emailjs.com")=>{if(!e)return;const t=j(e);o.publicKey=t.publicKey,o.blockHeadless=t.blockHeadless,o.storageProvider=t.storageProvider,o.blockList=t.blockList,o.limitRate=t.limitRate,o.origin=t.origin||r},R=async(e,r,t={})=>{const s=await fetch(o.origin+e,{method:"POST",headers:t,body:r}),a=await s.text(),i=new g(s.status,a);if(s.ok)return i;throw i},S=(e,r,t)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!r||typeof r!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},O=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},T=e=>e.webdriver||!e.languages||e.languages.length===0,L=()=>new g(451,"Unavailable For Headless Browser"),C=(e,r)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof r!="string")throw"The BlockList watchVariable has to be a string"},M=e=>!e.list?.length||!e.watchVariable,J=(e,r)=>e instanceof FormData?e.get(r):e[r],_=(e,r)=>{if(M(e))return!1;C(e.list,e.watchVariable);const t=J(r,e.watchVariable);return typeof t!="string"?!1:e.list.includes(t)},A=()=>new g(403,"Forbidden"),z=(e,r)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(r&&typeof r!="string")throw"The LimitRate ID has to be a non-empty string"},I=async(e,r,t)=>{const s=Number(await t.get(e)||0);return r-Date.now()+s},H=async(e,r,t)=>{if(!r.throttle||!t)return!1;z(r.throttle,r.id);const s=r.id||e;return await I(s,r.throttle,t)>0?!0:(await t.set(s,Date.now().toString()),!1)},D=()=>new g(429,"Too Many Requests"),G=async(e,r,t,s)=>{const a=j(s),i=a.publicKey||o.publicKey,d=a.blockHeadless||o.blockHeadless,h=a.storageProvider||o.storageProvider,w={...o.blockList,...a.blockList},b={...o.limitRate,...a.limitRate};return d&&T(navigator)?Promise.reject(L()):(S(i,e,r),O(t),t&&_(w,t)?Promise.reject(A()):await H(location.pathname,b,h)?Promise.reject(D()):R("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:e,template_id:r,template_params:t}),{"Content-type":"application/json"}))},U=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},W=e=>typeof e=="string"?document.querySelector(e):e,Q=async(e,r,t,s)=>{const a=j(s),i=a.publicKey||o.publicKey,d=a.blockHeadless||o.blockHeadless,h=o.storageProvider||a.storageProvider,w={...o.blockList,...a.blockList},b={...o.limitRate,...a.limitRate};if(d&&T(navigator))return Promise.reject(L());const y=W(t);S(i,e,r),U(y);const u=new FormData(y);return _(w,u)?Promise.reject(A()):await H(location.pathname,b,h)?Promise.reject(D()):(u.append("lib_version","4.4.1"),u.append("service_id",e),u.append("template_id",r),u.append("user_id",i),R("/api/v1.0/email/send-form",u))},X={init:K,send:G,sendForm:Q,EmailJSResponseStatus:g},Y="service_ut10vml",Z="template_vn2lufl",$="template_lo7pcvp",ee="ESq6kz1urCyDp34G8",re=e=>!!e,B=async(e,r)=>{if(!re(e)){console.warn("EmailJS no esta configurado; se omite el envio.");return}try{await X.send(Y,e,r,{publicKey:ee})}catch(t){console.error("Error al enviar correo:",t)}},te=async e=>{if(!e.programmerEmail){console.warn("No se envio correo: falta correo del programador.");return}await B($,{to_email:e.programmerEmail,programmer_name:e.programmerName||"Programador",requester_name:e.requesterName,requester_email:e.requesterEmail,date:e.date,time:e.time,note:e.note||"Sin comentarios adicionales."})},se=async e=>{if(!e.requesterEmail){console.warn("No se envio correo: falta correo del solicitante.");return}await B(Z,{to_email:e.requesterEmail,requester_name:e.requesterName||"Cliente",programmer_name:e.programmerName||"Programador",status:e.status,date:e.date||"Fecha por confirmar",time:e.time||"Hora por confirmar",response_message:e.responseMessage||(e.status==="aprobada"?"Tu solicitud fue aprobada.":"Tu solicitud fue rechazada.")})},c={users:"users",portfolios:"portfolios",projects:"projects",schedules:"schedules",advisories:"advisories"},F=async(e,r)=>{if(!e)return r||{};try{const t=l(n,c.users,e),s=await f(t);if(!s.exists())return r||{};const a=s.data();return{programmerEmail:a.email||r?.programmerEmail,programmerName:a.displayName||r?.programmerName}}catch(t){return console.error("No se pudo obtener el contacto del programador:",t),r||{}}},oe=async(e,r)=>{try{await q(l(n,c.users,e),{...r,updatedAt:m()})}catch(t){throw console.error("Error en upsertProgrammer:",t),t}},ie=async()=>{const e=v(p(n,c.users),P("role","==","programmer"));return(await E(e)).docs.map(t=>({id:t.id,...t.data()}))},ne=async e=>{await V(l(n,c.users,e))},ce=async e=>{const r=l(n,c.portfolios,e),t=await f(r);return t.exists()?t.data():null},me=async(e,r)=>{await q(l(n,c.portfolios,e),{...r,ownerId:e,updatedAt:m()})},le=async e=>{const r=v(p(n,c.projects),P("ownerId","==",e));return(await E(r)).docs.map(s=>({id:s.id,...s.data()}))},ue=async(e,r)=>await k(p(n,c.projects),{...r,ownerId:e,createdAt:m(),updatedAt:m()}),de=async(e,r)=>N(l(n,c.projects,e),{...r,updatedAt:m()}),pe=async e=>{const r=await F(e.programmerId,{programmerEmail:e.programmerEmail,programmerName:e.programmerName}),t={...e,programmerEmail:r.programmerEmail,programmerName:r.programmerName,status:"pendiente",createdAt:m(),updatedAt:m()},s=await k(p(n,c.advisories),t);return await te({programmerEmail:t.programmerEmail,programmerName:t.programmerName,requesterName:e.requesterName,requesterEmail:e.requesterEmail,date:e.slot.date,time:e.slot.time,note:e.note}),s},ge=async e=>{const r=v(p(n,c.advisories),P("programmerId","==",e));return(await E(r)).docs.map(s=>({id:s.id,...s.data()}))},fe=async(e,r,t)=>{const s=l(n,c.advisories,e),a=await f(s);if(!a.exists())throw new Error("La asesoria no existe");const i=a.data();await N(s,{status:r,responseMessage:t,updatedAt:m()});const d=await F(i.programmerId,{programmerEmail:i.programmerEmail,programmerName:i.programmerName});await se({requesterEmail:i.requesterEmail,requesterName:i.requesterName,programmerName:d.programmerName,status:r,date:i.slot?.date,time:i.slot?.time,responseMessage:t})},he=async(e,r)=>{await q(l(n,c.schedules,e),{programmerId:e,slots:r,updatedAt:m()})},we=async e=>{const r=l(n,c.schedules,e),t=await f(r);return t.exists()?t.data():null};export{ie as a,pe as b,we as c,ne as d,he as e,me as f,ce as g,de as h,ue as i,ge as j,fe as k,le as l,oe as u};
