import{u as y,r as n,j as e}from"./index-DuBGklgq.js";import{h as v,i as g,j as k}from"./firestore-RHlngpKj.js";const w=()=>{const{user:r}=y(),[d,b]=n.useState([]),[i,u]=n.useState(!1),[x,o]=n.useState(""),[a,c]=n.useState("pendiente"),N=()=>{b([])},m=async()=>{if(r?.uid){u(!0),o("");try{const s=await v(r.uid);b(s)}catch{o("No se pudieron cargar las asesorías.")}finally{u(!1)}}};n.useEffect(()=>{m()},[r?.uid]);const h=async(s,l,j)=>{try{const t=d.find(f=>f.id===s);await g(s,l,j||(l==="aprobada"?"Confirmada":"Rechazada")),t&&await k({requesterEmail:t.requesterEmail,requesterName:t.requesterName,programmerName:r?.displayName||"Programador",status:l,date:t.slot?.date,time:t.slot?.time,responseMessage:j||(l==="aprobada"?"Confirmada":"Rechazada")}),await m()}catch{o("No se pudo actualizar el estado.")}},p=a==="todas"?d:d.filter(s=>s.status===a);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Asesorías"}),e.jsx("p",{className:"text-base-content/70",children:"Revisa solicitudes y aprueba o rechaza con feedback."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-outline btn-sm",onClick:m,disabled:i,children:"Recargar"}),e.jsx("button",{className:"btn btn-outline btn-sm",onClick:N,disabled:i,children:"Limpiar Historial"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`btn btn-sm ${a==="pendiente"?"btn-primary":"btn-outline"}`,onClick:()=>c("pendiente"),children:"Pendientes"}),e.jsx("button",{className:`btn btn-sm ${a==="aprobada"?"btn-success":"btn-outline"}`,onClick:()=>c("aprobada"),children:"Aprobadas"}),e.jsx("button",{className:`btn btn-sm ${a==="rechazada"?"btn-error":"btn-outline"}`,onClick:()=>c("rechazada"),children:"Rechazadas"}),e.jsx("button",{className:`btn btn-sm ${a==="todas"?"btn-accent":"btn-outline"}`,onClick:()=>c("todas"),children:"Todas"})]}),x&&e.jsx("div",{className:"alert alert-error text-sm",children:x}),i&&e.jsx("div",{className:"skeleton h-20 w-full"}),e.jsxs("div",{className:"space-y-2",children:[p.map(s=>e.jsx("div",{className:"card bg-base-100 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.requesterName}),e.jsx("p",{className:"text-xs text-base-content/60",children:s.requesterEmail})]}),e.jsx("span",{className:"badge badge-outline capitalize",children:s.status})]}),e.jsxs("p",{className:"text-sm",children:["Fecha: ",s.slot?.date," · Hora: ",s.slot?.time]}),e.jsx("p",{className:"text-sm text-base-content/70",children:s.note}),s.status==="pending"&&e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>h(s.id,"aprobada"),children:"Aprobar"}),e.jsx("button",{className:"btn btn-error btn-sm",onClick:()=>h(s.id,"rechazada"),children:"Rechazar"})]})]})},s.id)),!p.length&&!i&&e.jsxs("div",{className:"alert alert-info text-sm",children:["No hay solicitudes ",a==="todas"?"":a==="pendiente"?"pendientes":`${a}s`,"."]})]})]})};export{w as default};
